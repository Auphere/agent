INFO:     Will watch for changes in these directories: ['/Users/lmatos/Workspace/auphere/auphere-agent']
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     Started reloader process [16303] using StatReload
INFO:     Started server process [16307]
INFO:     Waiting for application startup.
[2m2025-12-02T16:29:01.533223Z[0m [[32m[1minfo     [0m] [1müöÄ Starting Auphere Agent      [0m [36menvironment[0m=[35mdevelopment[0m [36mversion[0m=[35m0.1.0[0m
[2m2025-12-02T16:29:01.533281Z[0m [[32m[1minfo     [0m] [1mInitializing database...      [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:29:01.542209Z[0m [[32m[1minfo     [0m] [1mdatabase_engine_created       [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mlocalhost:5432/auphere-agent[0m
2025-12-02 17:29:01,550 INFO sqlalchemy.engine.Engine select pg_catalog.version()
select pg_catalog.version()
2025-12-02 17:29:01,550 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 17:29:01,551 INFO sqlalchemy.engine.Engine select current_schema()
select current_schema()
2025-12-02 17:29:01,551 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 17:29:01,552 INFO sqlalchemy.engine.Engine show standard_conforming_strings
show standard_conforming_strings
2025-12-02 17:29:01,552 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 17:29:01,552 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:01,553 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 17:29:01,553 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[generated in 0.00010s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 17:29:01,556 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 17:29:01,556 INFO sqlalchemy.engine.Engine [cached since 0.00294s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.00294s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 17:29:01,557 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 17:29:01,557 INFO sqlalchemy.engine.Engine [cached since 0.003361s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.003361s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 17:29:01,557 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
[2m2025-12-02T16:29:01.557700Z[0m [[32m[1minfo     [0m] [1mdatabase_initialized          [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:29:01.557726Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database initialized        [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:29:01.557739Z[0m [[32m[1minfo     [0m] [1mConnecting to Redis cache...  [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:29:01.558798Z[0m [[32m[1minfo     [0m] [1mcache_connected               [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mredis://localhost:6379/0[0m
[2m2025-12-02T16:29:01.558823Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache connected       [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:29:01.558837Z[0m [[32m[1minfo     [0m] [1m‚úÖ Auphere Agent ready!        [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application startup complete.
[2m2025-12-02T16:29:08.880238Z[0m [[32m[1minfo     [0m] [1msession_factory_created       [0m [36menvironment[0m=[35mdevelopment[0m
2025-12-02 17:29:08,881 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:08,881 INFO sqlalchemy.engine.Engine SELECT 1
SELECT 1
2025-12-02 17:29:08,881 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ()
[generated in 0.00006s] ()
2025-12-02 17:29:08,882 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "GET /agent/health HTTP/1.1" 200 OK
[2m2025-12-02T16:29:08.975092Z[0m [[32m[1minfo     [0m] [1mlocale_loaded                 [0m [36menvironment[0m=[35mdevelopment[0m [36mkeys[0m=[35m6[0m [36mlanguage[0m=[35mes[0m
[2m2025-12-02T16:29:08.975191Z[0m [[32m[1minfo     [0m] [1mlocale_loaded                 [0m [36menvironment[0m=[35mdevelopment[0m [36mkeys[0m=[35m6[0m [36mlanguage[0m=[35men[0m
[2m2025-12-02T16:29:08.975970Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m46b31b6c-fdae-4b75-9dac-6d7d109f36c6[0m [36muser_id[0m=[35md13d9911-e63e-4816-935a-180aab655acf[0m
[2m2025-12-02T16:29:08.976281Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:46b31b6c-fdae-4b75-9dac-6d7d109f36c6[0m
2025-12-02 17:29:08,977 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:08,978 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:08,978 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ('46b31b6c-fdae-4b75-9dac-6d7d109f36c6', 10)
[generated in 0.00009s] ('46b31b6c-fdae-4b75-9dac-6d7d109f36c6', 10)
[2m2025-12-02T16:29:08.981601Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m46b31b6c-fdae-4b75-9dac-6d7d109f36c6[0m
[2m2025-12-02T16:29:08.981638Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m46b31b6c-fdae-4b75-9dac-6d7d109f36c6[0m [36muser_id[0m=[35md13d9911-e63e-4816-935a-180aab655acf[0m
[2m2025-12-02T16:29:08.981659Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mBusco bares en Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:10.656852Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.95[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T16:29:10.656952Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user is explicitly looking for bars in Zaragoza, which indicates a specific search for places.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:10.666434Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mBusco bares en Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:16.204629Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:16,206 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:16,206 INFO sqlalchemy.engine.Engine [generated in 0.00018s] (UUID('6940a0b9-56f6-4a8f-89d3-090f884d0798'), 'd13d9911-e63e-4816-935a-180aab655acf', '46b31b6c-fdae-4b75-9dac-6d7d109f36c6', 'Busco bares en Zaragoza', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Parece que hay un problema t√©cnico al intentar buscar bares en Zaragoza. \n\nSin embargo, puedo ayudarte a encontrar algunos bares populares. ¬øTe gustar√≠a que te recomendara algunos sin realizar la b√∫squeda?', '[]', 7228, 5, 11, '{"query_id": "fd555f27-1ff6-4f89-87d5-855133ad2b1d", "reasoning": "The user is explicitly looking for bars in Zaragoza, which indicates a specific search for places.", "cost_usd": 6.825e-06}')
[generated in 0.00018s] (UUID('6940a0b9-56f6-4a8f-89d3-090f884d0798'), 'd13d9911-e63e-4816-935a-180aab655acf', '46b31b6c-fdae-4b75-9dac-6d7d109f36c6', 'Busco bares en Zaragoza', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Parece que hay un problema t√©cnico al intentar buscar bares en Zaragoza. \n\nSin embargo, puedo ayudarte a encontrar algunos bares populares. ¬øTe gustar√≠a que te recomendara algunos sin realizar la b√∫squeda?', '[]', 7228, 5, 11, '{"query_id": "fd555f27-1ff6-4f89-87d5-855133ad2b1d", "reasoning": "The user is explicitly looking for bars in Zaragoza, which indicates a specific search for places.", "cost_usd": 6.825e-06}')
[2m2025-12-02T16:29:16.207479Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35m6940a0b9-56f6-4a8f-89d3-090f884d0798[0m [36muser_id[0m=[35md13d9911-e63e-4816-935a-180aab655acf[0m
[2m2025-12-02T16:29:16.207510Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35mfd555f27-1ff6-4f89-87d5-855133ad2b1d[0m
2025-12-02 17:29:16,208 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:16,208 INFO sqlalchemy.engine.Engine [generated in 0.00005s] (datetime.date(2025, 12, 2), 16)
[generated in 0.00005s] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:16,210 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:16,210 INFO sqlalchemy.engine.Engine [generated in 0.00010s] (37, 5734.027027027027, 0.9108108108108103, 17, 0.002253355, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[generated in 0.00010s] (37, 5734.027027027027, 0.9108108108108103, 17, 0.002253355, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:16.212000Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:16.212051Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m6.825e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m7228[0m [36mquery_id[0m=[35mfd555f27-1ff6-4f89-87d5-855133ad2b1d[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:16.212073Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m6.825e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35mfd555f27-1ff6-4f89-87d5-855133ad2b1d[0m
2025-12-02 17:29:16,212 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:16.221845Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m [36muser_id[0m=[35meb4861d9-25f0-4b2a-8359-cbf6a07f99c6[0m
[2m2025-12-02T16:29:16.222165Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m
2025-12-02 17:29:16,222 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:16,222 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:16,222 INFO sqlalchemy.engine.Engine [cached since 7.244s ago] ('8ac7f56e-dd18-4581-a040-37c7cdea1d6f', 10)
[cached since 7.244s ago] ('8ac7f56e-dd18-4581-a040-37c7cdea1d6f', 10)
[2m2025-12-02T16:29:16.223540Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m
[2m2025-12-02T16:29:16.223562Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m [36muser_id[0m=[35meb4861d9-25f0-4b2a-8359-cbf6a07f99c6[0m
[2m2025-12-02T16:29:16.223577Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mHola, busco un restaurante rom√°ntico[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:18.523955Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m
[2m2025-12-02T16:29:18.524000Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mreasoning[0m=[35mThe user is asking for a suggestion for a romantic restaurant, which indicates a desire for recommendations rather than a specific search for a location.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:18.532618Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mHola, busco un restaurante rom√°ntico[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:19.501610Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:19,501 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:19,502 INFO sqlalchemy.engine.Engine [cached since 3.296s ago] (UUID('3e720bf5-c835-48c1-91d8-03ef28d38892'), 'eb4861d9-25f0-4b2a-8359-cbf6a07f99c6', '8ac7f56e-dd18-4581-a040-37c7cdea1d6f', 'Hola, busco un restaurante rom√°ntico', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', '¬øEn qu√© ciudad te gustar√≠a buscar un restaurante rom√°ntico?', '[]', 3279, 1, 3, '{"query_id": "32bf750c-4380-4e23-a7f5-7bbd92bef9e5", "reasoning": "The user is asking for a suggestion for a romantic restaurant, which indicates a desire for recommendations rather than a specific search for a location.", "cost_usd": 2.7300000000000005e-06}')
[cached since 3.296s ago] (UUID('3e720bf5-c835-48c1-91d8-03ef28d38892'), 'eb4861d9-25f0-4b2a-8359-cbf6a07f99c6', '8ac7f56e-dd18-4581-a040-37c7cdea1d6f', 'Hola, busco un restaurante rom√°ntico', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', '¬øEn qu√© ciudad te gustar√≠a buscar un restaurante rom√°ntico?', '[]', 3279, 1, 3, '{"query_id": "32bf750c-4380-4e23-a7f5-7bbd92bef9e5", "reasoning": "The user is asking for a suggestion for a romantic restaurant, which indicates a desire for recommendations rather than a specific search for a location.", "cost_usd": 2.7300000000000005e-06}')
[2m2025-12-02T16:29:19.502628Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mturn_id[0m=[35m3e720bf5-c835-48c1-91d8-03ef28d38892[0m [36muser_id[0m=[35meb4861d9-25f0-4b2a-8359-cbf6a07f99c6[0m
[2m2025-12-02T16:29:19.502654Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m32bf750c-4380-4e23-a7f5-7bbd92bef9e5[0m
2025-12-02 17:29:19,502 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:19,502 INFO sqlalchemy.engine.Engine [cached since 3.295s ago] (datetime.date(2025, 12, 2), 16)
[cached since 3.295s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:19,503 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:19,503 INFO sqlalchemy.engine.Engine [generated in 0.00008s] (38, 5669.421052631579, 0.9105263157894732, 13, 0.0022560849999999997, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[generated in 0.00008s] (38, 5669.421052631579, 0.9105263157894732, 13, 0.0022560849999999997, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:19.504153Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:19.504195Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m2.7300000000000005e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m3279[0m [36mquery_id[0m=[35m32bf750c-4380-4e23-a7f5-7bbd92bef9e5[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:19.504216Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m2.7300000000000005e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m32bf750c-4380-4e23-a7f5-7bbd92bef9e5[0m
2025-12-02 17:29:19,504 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:19.514613Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m [36muser_id[0m=[35meb4861d9-25f0-4b2a-8359-cbf6a07f99c6[0m
[2m2025-12-02T16:29:19.514883Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m
2025-12-02 17:29:19,515 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:19,515 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:19,515 INFO sqlalchemy.engine.Engine [cached since 10.54s ago] ('8ac7f56e-dd18-4581-a040-37c7cdea1d6f', 10)
[cached since 10.54s ago] ('8ac7f56e-dd18-4581-a040-37c7cdea1d6f', 10)
[2m2025-12-02T16:29:19.516182Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m1[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m
[2m2025-12-02T16:29:19.516402Z[0m [[32m[1mdebug    [0m] [1mcache_set                     [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m [36mttl[0m=[35m300[0m
[2m2025-12-02T16:29:19.516422Z[0m [[32m[1mdebug    [0m] [1msession_context_built         [0m [36mchars[0m=[35m187[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m [36mturns[0m=[35m1[0m
[2m2025-12-02T16:29:19.516440Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mTrue[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m8ac7f56e-dd18-4581-a040-37c7cdea1d6f[0m [36muser_id[0m=[35meb4861d9-25f0-4b2a-8359-cbf6a07f99c6[0m
[2m2025-12-02T16:29:19.516454Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mEn Zaragoza, por el centro hist√≥rico[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:21.083520Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T16:29:21.083627Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user provided a specific location (Zaragoza) and mentioned a specific area (centro hist√≥rico), indicating they are looking for places or information related to that location.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:21.100079Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mEn Zaragoza, por el centro hist√≥rico[0m
[2m2025-12-02T16:29:21.100180Z[0m [[32m[1minfo     [0m] [1magent-using-history           [0m [36menvironment[0m=[35mdevelopment[0m [36mhistory_length[0m=[35m187[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:28.862574Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:28,862 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:28,862 INFO sqlalchemy.engine.Engine [cached since 12.66s ago] (UUID('c19ca258-c8a5-46ad-a8f0-ba4753a90c18'), 'eb4861d9-25f0-4b2a-8359-cbf6a07f99c6', '8ac7f56e-dd18-4581-a040-37c7cdea1d6f', 'En Zaragoza, por el centro hist√≥rico', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Parece que he tenido un problema al buscar restaurantes en Zaragoza. Sin embargo, puedo ayudarte a encontrar algunas opciones. \n\nTe recomendar√≠a co ... (273 characters truncated) ... e** - Con un ambiente √≠ntimo y una buena selecci√≥n de vinos.\n\nSi deseas m√°s detalles o informaci√≥n espec√≠fica sobre alguno de ellos, h√°zmelo saber.', '[]', 9347, 6, 13, '{"query_id": "05c27f21-a44e-4bc1-a6fc-a342b76e4271", "reasoning": "The user provided a specific location (Zaragoza) and mentioned a specific area (centro hist\\u00f3rico), indicating they are looking for places or information related to that location.", "cost_usd": 1.7939999999999998e-05}')
[cached since 12.66s ago] (UUID('c19ca258-c8a5-46ad-a8f0-ba4753a90c18'), 'eb4861d9-25f0-4b2a-8359-cbf6a07f99c6', '8ac7f56e-dd18-4581-a040-37c7cdea1d6f', 'En Zaragoza, por el centro hist√≥rico', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Parece que he tenido un problema al buscar restaurantes en Zaragoza. Sin embargo, puedo ayudarte a encontrar algunas opciones. \n\nTe recomendar√≠a co ... (273 characters truncated) ... e** - Con un ambiente √≠ntimo y una buena selecci√≥n de vinos.\n\nSi deseas m√°s detalles o informaci√≥n espec√≠fica sobre alguno de ellos, h√°zmelo saber.', '[]', 9347, 6, 13, '{"query_id": "05c27f21-a44e-4bc1-a6fc-a342b76e4271", "reasoning": "The user provided a specific location (Zaragoza) and mentioned a specific area (centro hist\\u00f3rico), indicating they are looking for places or information related to that location.", "cost_usd": 1.7939999999999998e-05}')
[2m2025-12-02T16:29:28.863833Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35mc19ca258-c8a5-46ad-a8f0-ba4753a90c18[0m [36muser_id[0m=[35meb4861d9-25f0-4b2a-8359-cbf6a07f99c6[0m
[2m2025-12-02T16:29:28.863863Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m05c27f21-a44e-4bc1-a6fc-a342b76e4271[0m
2025-12-02 17:29:28,864 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:28,864 INFO sqlalchemy.engine.Engine [cached since 12.66s ago] (datetime.date(2025, 12, 2), 16)
[cached since 12.66s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:28,864 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:28,864 INFO sqlalchemy.engine.Engine [cached since 12.65s ago] (39, 5763.717948717948, 0.9102564102564097, 18, 0.002274025, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 12.65s ago] (39, 5763.717948717948, 0.9102564102564097, 18, 0.002274025, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:28.864847Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:28.864875Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m1.7939999999999998e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m9347[0m [36mquery_id[0m=[35m05c27f21-a44e-4bc1-a6fc-a342b76e4271[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:28.864892Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m1.7939999999999998e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m05c27f21-a44e-4bc1-a6fc-a342b76e4271[0m
2025-12-02 17:29:28,864 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:28.874212Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m5adf7071-a7af-4027-a17d-3b25a896798e[0m [36muser_id[0m=[35meccb357d-ea1e-43ee-b722-3103e7ea5f61[0m
[2m2025-12-02T16:29:28.874481Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:5adf7071-a7af-4027-a17d-3b25a896798e[0m
2025-12-02 17:29:28,875 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:28,875 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:28,875 INFO sqlalchemy.engine.Engine [cached since 19.9s ago] ('5adf7071-a7af-4027-a17d-3b25a896798e', 10)
[cached since 19.9s ago] ('5adf7071-a7af-4027-a17d-3b25a896798e', 10)
[2m2025-12-02T16:29:28.875748Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m5adf7071-a7af-4027-a17d-3b25a896798e[0m
[2m2025-12-02T16:29:28.875774Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m5adf7071-a7af-4027-a17d-3b25a896798e[0m [36muser_id[0m=[35meccb357d-ea1e-43ee-b722-3103e7ea5f61[0m
[2m2025-12-02T16:29:28.875791Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mHola, ¬øc√≥mo est√°s?[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:30.402920Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mCHITCHAT[0m
[2m2025-12-02T16:29:30.402979Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mCHITCHAT[0m [36mreasoning[0m=[35mThe user is engaging in casual conversation without any specific request related to places or planning.[0m [36mselected[0m=[35mgpt-3.5-turbo[0m
[2m2025-12-02T16:29:30.413732Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-3.5-turbo[0m [36mquery[0m=[35mHola, ¬øc√≥mo est√°s?[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:31.321852Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:31,322 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:31,322 INFO sqlalchemy.engine.Engine [cached since 15.12s ago] (UUID('4f0858fb-46d7-4abe-95fc-ba2a9968418d'), 'eccb357d-ea1e-43ee-b722-3103e7ea5f61', '5adf7071-a7af-4027-a17d-3b25a896798e', 'Hola, ¬øc√≥mo est√°s?', 'es', 'CHITCHAT', 0.9, 'low', 'gpt-3.5-turbo', 'openai', '¬°Hola! Estoy aqu√≠ para ayudarte a descubrir lugares y planificar experiencias en Zaragoza. ¬øEn qu√© puedo ayudarte hoy?', '[]', 2447, 1, 3, '{"query_id": "adbc8828-5135-4bd0-9b94-b0cd70c68b3e", "reasoning": "The user is engaging in casual conversation without any specific request related to places or planning.", "cost_usd": 1.3650000000000003e-05}')
[cached since 15.12s ago] (UUID('4f0858fb-46d7-4abe-95fc-ba2a9968418d'), 'eccb357d-ea1e-43ee-b722-3103e7ea5f61', '5adf7071-a7af-4027-a17d-3b25a896798e', 'Hola, ¬øc√≥mo est√°s?', 'es', 'CHITCHAT', 0.9, 'low', 'gpt-3.5-turbo', 'openai', '¬°Hola! Estoy aqu√≠ para ayudarte a descubrir lugares y planificar experiencias en Zaragoza. ¬øEn qu√© puedo ayudarte hoy?', '[]', 2447, 1, 3, '{"query_id": "adbc8828-5135-4bd0-9b94-b0cd70c68b3e", "reasoning": "The user is engaging in casual conversation without any specific request related to places or planning.", "cost_usd": 1.3650000000000003e-05}')
[2m2025-12-02T16:29:31.322840Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mCHITCHAT[0m [36mturn_id[0m=[35m4f0858fb-46d7-4abe-95fc-ba2a9968418d[0m [36muser_id[0m=[35meccb357d-ea1e-43ee-b722-3103e7ea5f61[0m
[2m2025-12-02T16:29:31.322866Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35madbc8828-5135-4bd0-9b94-b0cd70c68b3e[0m
2025-12-02 17:29:31,323 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:31,323 INFO sqlalchemy.engine.Engine [cached since 15.11s ago] (datetime.date(2025, 12, 2), 16)
[cached since 15.11s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:31,323 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, chitchat_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, chitchat_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:31,323 INFO sqlalchemy.engine.Engine [generated in 0.00005s] (40, 5680.799999999999, 0.9099999999999995, 6, 0.002287675, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[generated in 0.00005s] (40, 5680.799999999999, 0.9099999999999995, 6, 0.002287675, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:31.324246Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mCHITCHAT[0m [36mmodel[0m=[35mgpt-3.5-turbo[0m
[2m2025-12-02T16:29:31.324277Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m1.3650000000000003e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mCHITCHAT[0m [36mmodel[0m=[35mgpt-3.5-turbo[0m [36mprocessing_time_ms[0m=[35m2447[0m [36mquery_id[0m=[35madbc8828-5135-4bd0-9b94-b0cd70c68b3e[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:31.324303Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m1.3650000000000003e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35madbc8828-5135-4bd0-9b94-b0cd70c68b3e[0m
2025-12-02 17:29:31,324 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:31.334169Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m8baf865d-4616-4356-8fca-cc8380262c89[0m [36muser_id[0m=[35mc7111df5-dd39-4646-bde0-3cc3197e9384[0m
[2m2025-12-02T16:29:31.334425Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:8baf865d-4616-4356-8fca-cc8380262c89[0m
2025-12-02 17:29:31,335 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:31,335 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:31,335 INFO sqlalchemy.engine.Engine [cached since 22.36s ago] ('8baf865d-4616-4356-8fca-cc8380262c89', 10)
[cached since 22.36s ago] ('8baf865d-4616-4356-8fca-cc8380262c89', 10)
[2m2025-12-02T16:29:31.335739Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m8baf865d-4616-4356-8fca-cc8380262c89[0m
[2m2025-12-02T16:29:31.335778Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m8baf865d-4616-4356-8fca-cc8380262c89[0m [36muser_id[0m=[35mc7111df5-dd39-4646-bde0-3cc3197e9384[0m
[2m2025-12-02T16:29:31.335799Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mBusco cafeter√≠as en Madrid[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:33.267417Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.95[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T16:29:33.267473Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user is explicitly looking for cafes in Madrid, which fits the SEARCH category.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:33.276139Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mBusco cafeter√≠as en Madrid[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:34.352012Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:34,352 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:34,352 INFO sqlalchemy.engine.Engine [cached since 18.15s ago] (UUID('112a6dd1-a699-49ff-9c8a-0f65618029a3'), 'c7111df5-dd39-4646-bde0-3cc3197e9384', '8baf865d-4616-4356-8fca-cc8380262c89', 'Busco cafeter√≠as en Madrid', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Lo siento, actualmente solo tengo informaci√≥n de lugares en Zaragoza. ¬øTe gustar√≠a buscar algo all√≠?', '[]', 3017, 1, 3, '{"query_id": "e8743473-09da-4a2b-afe2-140d79504dad", "reasoning": "The user is explicitly looking for cafes in Madrid, which fits the SEARCH category.", "cost_usd": 3.7049999999999997e-06}')
[cached since 18.15s ago] (UUID('112a6dd1-a699-49ff-9c8a-0f65618029a3'), 'c7111df5-dd39-4646-bde0-3cc3197e9384', '8baf865d-4616-4356-8fca-cc8380262c89', 'Busco cafeter√≠as en Madrid', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Lo siento, actualmente solo tengo informaci√≥n de lugares en Zaragoza. ¬øTe gustar√≠a buscar algo all√≠?', '[]', 3017, 1, 3, '{"query_id": "e8743473-09da-4a2b-afe2-140d79504dad", "reasoning": "The user is explicitly looking for cafes in Madrid, which fits the SEARCH category.", "cost_usd": 3.7049999999999997e-06}')
[2m2025-12-02T16:29:34.353057Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35m112a6dd1-a699-49ff-9c8a-0f65618029a3[0m [36muser_id[0m=[35mc7111df5-dd39-4646-bde0-3cc3197e9384[0m
[2m2025-12-02T16:29:34.353083Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35me8743473-09da-4a2b-afe2-140d79504dad[0m
2025-12-02 17:29:34,353 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:34,353 INFO sqlalchemy.engine.Engine [cached since 18.15s ago] (datetime.date(2025, 12, 2), 16)
[cached since 18.15s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:34,353 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:34,353 INFO sqlalchemy.engine.Engine [cached since 18.14s ago] (41, 5615.829268292682, 0.910975609756097, 19, 0.00229138, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 18.14s ago] (41, 5615.829268292682, 0.910975609756097, 19, 0.00229138, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:34.354210Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:34.354246Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m3.7049999999999997e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m3017[0m [36mquery_id[0m=[35me8743473-09da-4a2b-afe2-140d79504dad[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:34.354266Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m3.7049999999999997e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35me8743473-09da-4a2b-afe2-140d79504dad[0m
2025-12-02 17:29:34,354 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:34.363968Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35md2342715-b602-459a-83ce-881445f3f5a7[0m [36muser_id[0m=[35m310a8bf3-23c6-4a9f-9629-89ee2575fe02[0m
[2m2025-12-02T16:29:34.364252Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:d2342715-b602-459a-83ce-881445f3f5a7[0m
2025-12-02 17:29:34,364 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:34,364 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:34,365 INFO sqlalchemy.engine.Engine [cached since 25.39s ago] ('d2342715-b602-459a-83ce-881445f3f5a7', 10)
[cached since 25.39s ago] ('d2342715-b602-459a-83ce-881445f3f5a7', 10)
[2m2025-12-02T16:29:34.365571Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35md2342715-b602-459a-83ce-881445f3f5a7[0m
[2m2025-12-02T16:29:34.365595Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35md2342715-b602-459a-83ce-881445f3f5a7[0m [36muser_id[0m=[35m310a8bf3-23c6-4a9f-9629-89ee2575fe02[0m
[2m2025-12-02T16:29:34.365611Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mQuiero ir a un museo[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:36.542449Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m
[2m2025-12-02T16:29:36.542492Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mreasoning[0m=[35mEl usuario est√° buscando sugerencias sobre museos, pero no proporciona un lugar espec√≠fico ni un tipo de museo, lo que indica que est√° buscando recomendaciones generales.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:36.550900Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mQuiero ir a un museo[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:41.768538Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:41,768 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:41,768 INFO sqlalchemy.engine.Engine [cached since 25.56s ago] (UUID('242571ef-1bea-4136-abe0-9e563dc02497'), '310a8bf3-23c6-4a9f-9629-89ee2575fe02', 'd2342715-b602-459a-83ce-881445f3f5a7', 'Quiero ir a un museo', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', '¬øEn qu√© ciudad te gustar√≠a buscar un museo?', '[]', 7404, 1, 3, '{"query_id": "890672a5-eaa5-4ced-a951-fcb3ee6789de", "reasoning": "El usuario est\\u00e1 buscando sugerencias sobre museos, pero no proporciona un lugar espec\\u00edfico ni un tipo de museo, lo que indica que est\\u00e1 buscando recomendaciones generales.", "cost_usd": 2.5349999999999994e-06}')
[cached since 25.56s ago] (UUID('242571ef-1bea-4136-abe0-9e563dc02497'), '310a8bf3-23c6-4a9f-9629-89ee2575fe02', 'd2342715-b602-459a-83ce-881445f3f5a7', 'Quiero ir a un museo', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', '¬øEn qu√© ciudad te gustar√≠a buscar un museo?', '[]', 7404, 1, 3, '{"query_id": "890672a5-eaa5-4ced-a951-fcb3ee6789de", "reasoning": "El usuario est\\u00e1 buscando sugerencias sobre museos, pero no proporciona un lugar espec\\u00edfico ni un tipo de museo, lo que indica que est\\u00e1 buscando recomendaciones generales.", "cost_usd": 2.5349999999999994e-06}')
[2m2025-12-02T16:29:41.769527Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mturn_id[0m=[35m242571ef-1bea-4136-abe0-9e563dc02497[0m [36muser_id[0m=[35m310a8bf3-23c6-4a9f-9629-89ee2575fe02[0m
[2m2025-12-02T16:29:41.769553Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m890672a5-eaa5-4ced-a951-fcb3ee6789de[0m
2025-12-02 17:29:41,769 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:41,769 INFO sqlalchemy.engine.Engine [cached since 25.56s ago] (datetime.date(2025, 12, 2), 16)
[cached since 25.56s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:41,770 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:41,770 INFO sqlalchemy.engine.Engine [cached since 22.27s ago] (42, 5658.4047619047615, 0.9107142857142853, 14, 0.002293915, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 22.27s ago] (42, 5658.4047619047615, 0.9107142857142853, 14, 0.002293915, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:41.770708Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:41.770739Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m2.5349999999999994e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m7404[0m [36mquery_id[0m=[35m890672a5-eaa5-4ced-a951-fcb3ee6789de[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:41.770762Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m2.5349999999999994e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m890672a5-eaa5-4ced-a951-fcb3ee6789de[0m
2025-12-02 17:29:41,770 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:41.780404Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m165292ed-06bb-46ec-9a1f-63d676b9709f[0m [36muser_id[0m=[35m83eeccd5-dc6d-4916-b641-9e794de9e364[0m
[2m2025-12-02T16:29:41.780673Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:165292ed-06bb-46ec-9a1f-63d676b9709f[0m
2025-12-02 17:29:41,781 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:41,781 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:41,781 INFO sqlalchemy.engine.Engine [cached since 32.8s ago] ('165292ed-06bb-46ec-9a1f-63d676b9709f', 10)
[cached since 32.8s ago] ('165292ed-06bb-46ec-9a1f-63d676b9709f', 10)
[2m2025-12-02T16:29:41.781824Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m165292ed-06bb-46ec-9a1f-63d676b9709f[0m
[2m2025-12-02T16:29:41.781847Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m165292ed-06bb-46ec-9a1f-63d676b9709f[0m [36muser_id[0m=[35m83eeccd5-dc6d-4916-b641-9e794de9e364[0m
[2m2025-12-02T16:29:41.781862Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mDame cafeter√≠as en el barrio de Delicias, Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:43.510505Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.95[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T16:29:43.510627Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user is asking for specific places (cafeter√≠as) in a specific location (Delicias, Zaragoza), which fits the SEARCH category.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:43.523549Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mDame cafeter√≠as en el barrio de Delicias, Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:48.778892Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:48,779 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:48,779 INFO sqlalchemy.engine.Engine [cached since 32.57s ago] (UUID('c5da1b55-e171-4a29-bdbd-17258d87d431'), '83eeccd5-dc6d-4916-b641-9e794de9e364', '165292ed-06bb-46ec-9a1f-63d676b9709f', 'Dame cafeter√≠as en el barrio de Delicias, Zaragoza', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Lo siento, parece que hay un problema t√©cnico al buscar cafeter√≠as. Sin embargo, puedo ayudarte a encontrar algunas opciones en el barrio de Delicias, Zaragoza. \n\n¬øTe gustar√≠a que te recomiende algunas cafeter√≠as populares de esa zona?', '[]', 6998, 4, 9, '{"query_id": "537eb593-740e-46c0-8397-f9ad1fa49aa0", "reasoning": "The user is asking for specific places (cafeter\\u00edas) in a specific location (Delicias, Zaragoza), which fits the SEARCH category.", "cost_usd": 8.58e-06}')
[cached since 32.57s ago] (UUID('c5da1b55-e171-4a29-bdbd-17258d87d431'), '83eeccd5-dc6d-4916-b641-9e794de9e364', '165292ed-06bb-46ec-9a1f-63d676b9709f', 'Dame cafeter√≠as en el barrio de Delicias, Zaragoza', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Lo siento, parece que hay un problema t√©cnico al buscar cafeter√≠as. Sin embargo, puedo ayudarte a encontrar algunas opciones en el barrio de Delicias, Zaragoza. \n\n¬øTe gustar√≠a que te recomiende algunas cafeter√≠as populares de esa zona?', '[]', 6998, 4, 9, '{"query_id": "537eb593-740e-46c0-8397-f9ad1fa49aa0", "reasoning": "The user is asking for specific places (cafeter\\u00edas) in a specific location (Delicias, Zaragoza), which fits the SEARCH category.", "cost_usd": 8.58e-06}')
[2m2025-12-02T16:29:48.779787Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35mc5da1b55-e171-4a29-bdbd-17258d87d431[0m [36muser_id[0m=[35m83eeccd5-dc6d-4916-b641-9e794de9e364[0m
[2m2025-12-02T16:29:48.779809Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m537eb593-740e-46c0-8397-f9ad1fa49aa0[0m
2025-12-02 17:29:48,779 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:48,779 INFO sqlalchemy.engine.Engine [cached since 32.57s ago] (datetime.date(2025, 12, 2), 16)
[cached since 32.57s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:48,780 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:48,780 INFO sqlalchemy.engine.Engine [cached since 32.57s ago] (43, 5689.558139534883, 0.9116279069767438, 20, 0.002302495, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 32.57s ago] (43, 5689.558139534883, 0.9116279069767438, 20, 0.002302495, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:48.780803Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:48.780832Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m8.58e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m6998[0m [36mquery_id[0m=[35m537eb593-740e-46c0-8397-f9ad1fa49aa0[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:48.780851Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m8.58e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m537eb593-740e-46c0-8397-f9ad1fa49aa0[0m
2025-12-02 17:29:48,780 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:48.790357Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m [36muser_id[0m=[35m85b8ef09-03f5-4ae7-9853-2c97455b6cc1[0m
[2m2025-12-02T16:29:48.790590Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:a0ff60e3-41e5-43ba-851a-31e0f8783427[0m
2025-12-02 17:29:48,791 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:48,791 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:48,791 INFO sqlalchemy.engine.Engine [cached since 39.81s ago] ('a0ff60e3-41e5-43ba-851a-31e0f8783427', 10)
[cached since 39.81s ago] ('a0ff60e3-41e5-43ba-851a-31e0f8783427', 10)
[2m2025-12-02T16:29:48.791579Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m
[2m2025-12-02T16:29:48.791600Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m [36muser_id[0m=[35m85b8ef09-03f5-4ae7-9853-2c97455b6cc1[0m
[2m2025-12-02T16:29:48.791615Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mBusco un lugar para cenar[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:50.341965Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T16:29:50.342033Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user is explicitly looking for a place to have dinner, which indicates a specific search for a location.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:50.350932Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mBusco un lugar para cenar[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:51.238281Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:51,238 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:51,238 INFO sqlalchemy.engine.Engine [cached since 35.03s ago] (UUID('e7267e0d-28bb-4d20-aaff-992a4c704f33'), '85b8ef09-03f5-4ae7-9853-2c97455b6cc1', 'a0ff60e3-41e5-43ba-851a-31e0f8783427', 'Busco un lugar para cenar', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', '¬øEn qu√© ciudad te gustar√≠a buscar un lugar para cenar?', '[]', 2447, 1, 3, '{"query_id": "0448ee8f-daa8-44ae-88db-8caa7ec2890d", "reasoning": "The user is explicitly looking for a place to have dinner, which indicates a specific search for a location.", "cost_usd": 2.925e-06}')
[cached since 35.03s ago] (UUID('e7267e0d-28bb-4d20-aaff-992a4c704f33'), '85b8ef09-03f5-4ae7-9853-2c97455b6cc1', 'a0ff60e3-41e5-43ba-851a-31e0f8783427', 'Busco un lugar para cenar', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', '¬øEn qu√© ciudad te gustar√≠a buscar un lugar para cenar?', '[]', 2447, 1, 3, '{"query_id": "0448ee8f-daa8-44ae-88db-8caa7ec2890d", "reasoning": "The user is explicitly looking for a place to have dinner, which indicates a specific search for a location.", "cost_usd": 2.925e-06}')
[2m2025-12-02T16:29:51.239156Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35me7267e0d-28bb-4d20-aaff-992a4c704f33[0m [36muser_id[0m=[35m85b8ef09-03f5-4ae7-9853-2c97455b6cc1[0m
[2m2025-12-02T16:29:51.239182Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m0448ee8f-daa8-44ae-88db-8caa7ec2890d[0m
2025-12-02 17:29:51,239 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:51,239 INFO sqlalchemy.engine.Engine [cached since 35.03s ago] (datetime.date(2025, 12, 2), 16)
[cached since 35.03s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:51,239 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:51,239 INFO sqlalchemy.engine.Engine [cached since 35.03s ago] (44, 5615.863636363635, 0.9113636363636359, 21, 0.00230542, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 35.03s ago] (44, 5615.863636363635, 0.9113636363636359, 21, 0.00230542, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:51.239976Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:51.240004Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m2.925e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m2447[0m [36mquery_id[0m=[35m0448ee8f-daa8-44ae-88db-8caa7ec2890d[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:51.240022Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m2.925e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m0448ee8f-daa8-44ae-88db-8caa7ec2890d[0m
2025-12-02 17:29:51,240 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:51.250122Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m [36muser_id[0m=[35m85b8ef09-03f5-4ae7-9853-2c97455b6cc1[0m
[2m2025-12-02T16:29:51.250368Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:a0ff60e3-41e5-43ba-851a-31e0f8783427[0m
2025-12-02 17:29:51,250 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:51,250 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:51,251 INFO sqlalchemy.engine.Engine [cached since 42.27s ago] ('a0ff60e3-41e5-43ba-851a-31e0f8783427', 10)
[cached since 42.27s ago] ('a0ff60e3-41e5-43ba-851a-31e0f8783427', 10)
[2m2025-12-02T16:29:51.251380Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m1[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m
[2m2025-12-02T16:29:51.251601Z[0m [[32m[1mdebug    [0m] [1mcache_set                     [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:a0ff60e3-41e5-43ba-851a-31e0f8783427[0m [36mttl[0m=[35m300[0m
[2m2025-12-02T16:29:51.251618Z[0m [[32m[1mdebug    [0m] [1msession_context_built         [0m [36mchars[0m=[35m171[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m [36mturns[0m=[35m1[0m
[2m2025-12-02T16:29:51.251635Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mTrue[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m [36muser_id[0m=[35m85b8ef09-03f5-4ae7-9853-2c97455b6cc1[0m
[2m2025-12-02T16:29:51.251654Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mEn Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:52.930462Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T16:29:52.930657Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user provided a specific location (Zaragoza), indicating they are looking for information related to that place.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:52.949449Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mEn Zaragoza[0m
[2m2025-12-02T16:29:52.949637Z[0m [[32m[1minfo     [0m] [1magent-using-history           [0m [36menvironment[0m=[35mdevelopment[0m [36mhistory_length[0m=[35m171[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:54.157579Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:54,158 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:54,158 INFO sqlalchemy.engine.Engine [cached since 37.95s ago] (UUID('4d24410a-843c-41b7-b1a0-959f9842c881'), '85b8ef09-03f5-4ae7-9853-2c97455b6cc1', 'a0ff60e3-41e5-43ba-851a-31e0f8783427', 'En Zaragoza', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Perfecto. ¬øQu√© tipo de comida prefieres para la cena? ¬øAlgo espec√≠fico como italiana, espa√±ola, japonesa, o alg√∫n otro tipo?', '[]', 2907, 2, 5, '{"query_id": "e5294377-32d8-48b2-9f8c-841fd7c3dce8", "reasoning": "The user provided a specific location (Zaragoza), indicating they are looking for information related to that place.", "cost_usd": 4.095e-06}')
[cached since 37.95s ago] (UUID('4d24410a-843c-41b7-b1a0-959f9842c881'), '85b8ef09-03f5-4ae7-9853-2c97455b6cc1', 'a0ff60e3-41e5-43ba-851a-31e0f8783427', 'En Zaragoza', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Perfecto. ¬øQu√© tipo de comida prefieres para la cena? ¬øAlgo espec√≠fico como italiana, espa√±ola, japonesa, o alg√∫n otro tipo?', '[]', 2907, 2, 5, '{"query_id": "e5294377-32d8-48b2-9f8c-841fd7c3dce8", "reasoning": "The user provided a specific location (Zaragoza), indicating they are looking for information related to that place.", "cost_usd": 4.095e-06}')
[2m2025-12-02T16:29:54.159276Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35m4d24410a-843c-41b7-b1a0-959f9842c881[0m [36muser_id[0m=[35m85b8ef09-03f5-4ae7-9853-2c97455b6cc1[0m
[2m2025-12-02T16:29:54.159329Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35me5294377-32d8-48b2-9f8c-841fd7c3dce8[0m
2025-12-02 17:29:54,159 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:54,159 INFO sqlalchemy.engine.Engine [cached since 37.95s ago] (datetime.date(2025, 12, 2), 16)
[cached since 37.95s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:54,160 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:54,160 INFO sqlalchemy.engine.Engine [cached since 37.95s ago] (45, 5555.666666666665, 0.9111111111111106, 22, 0.002309515, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 37.95s ago] (45, 5555.666666666665, 0.9111111111111106, 22, 0.002309515, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:54.161095Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:54.161147Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m4.095e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m2907[0m [36mquery_id[0m=[35me5294377-32d8-48b2-9f8c-841fd7c3dce8[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:54.161179Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m4.095e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35me5294377-32d8-48b2-9f8c-841fd7c3dce8[0m
2025-12-02 17:29:54,161 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:54.174818Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m [36muser_id[0m=[35m85b8ef09-03f5-4ae7-9853-2c97455b6cc1[0m
[2m2025-12-02T16:29:54.175089Z[0m [[32m[1mdebug    [0m] [1mcache_hit                     [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:a0ff60e3-41e5-43ba-851a-31e0f8783427[0m
[2m2025-12-02T16:29:54.175123Z[0m [[32m[1mdebug    [0m] [1msession_context_cache_hit     [0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m
[2m2025-12-02T16:29:54.175142Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mTrue[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35ma0ff60e3-41e5-43ba-851a-31e0f8783427[0m [36muser_id[0m=[35m85b8ef09-03f5-4ae7-9853-2c97455b6cc1[0m
[2m2025-12-02T16:29:54.175164Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mAlgo tranquilo y no muy caro[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:55.488360Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m
[2m2025-12-02T16:29:55.488425Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mreasoning[0m=[35mThe user is looking for something calm and inexpensive, which suggests they are seeking suggestions rather than specific locations.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:55.496933Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mAlgo tranquilo y no muy caro[0m
[2m2025-12-02T16:29:55.496996Z[0m [[32m[1minfo     [0m] [1magent-using-history           [0m [36menvironment[0m=[35mdevelopment[0m [36mhistory_length[0m=[35m171[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:56.724607Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:29:56,725 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:56,725 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:29:56,725 INFO sqlalchemy.engine.Engine [cached since 40.52s ago] (UUID('44e5e6e2-5023-4917-a061-366dea7b9543'), '85b8ef09-03f5-4ae7-9853-2c97455b6cc1', 'a0ff60e3-41e5-43ba-851a-31e0f8783427', 'Algo tranquilo y no muy caro', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Lo siento, actualmente solo tengo informaci√≥n de lugares en Zaragoza. ¬øTe gustar√≠a buscar algo all√≠?', '[]', 2549, 2, 5, '{"query_id": "fa86daec-890a-4086-8388-c1a4436ab312", "reasoning": "The user is looking for something calm and inexpensive, which suggests they are seeking suggestions rather than specific locations.", "cost_usd": 4.095e-06}')
[cached since 40.52s ago] (UUID('44e5e6e2-5023-4917-a061-366dea7b9543'), '85b8ef09-03f5-4ae7-9853-2c97455b6cc1', 'a0ff60e3-41e5-43ba-851a-31e0f8783427', 'Algo tranquilo y no muy caro', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Lo siento, actualmente solo tengo informaci√≥n de lugares en Zaragoza. ¬øTe gustar√≠a buscar algo all√≠?', '[]', 2549, 2, 5, '{"query_id": "fa86daec-890a-4086-8388-c1a4436ab312", "reasoning": "The user is looking for something calm and inexpensive, which suggests they are seeking suggestions rather than specific locations.", "cost_usd": 4.095e-06}')
[2m2025-12-02T16:29:56.725932Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mturn_id[0m=[35m44e5e6e2-5023-4917-a061-366dea7b9543[0m [36muser_id[0m=[35m85b8ef09-03f5-4ae7-9853-2c97455b6cc1[0m
[2m2025-12-02T16:29:56.725959Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35mfa86daec-890a-4086-8388-c1a4436ab312[0m
2025-12-02 17:29:56,726 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:29:56,726 INFO sqlalchemy.engine.Engine [cached since 40.52s ago] (datetime.date(2025, 12, 2), 16)
[cached since 40.52s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:29:56,726 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:29:56,726 INFO sqlalchemy.engine.Engine [cached since 37.22s ago] (46, 5490.304347826086, 0.9108695652173908, 15, 0.00231361, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 37.22s ago] (46, 5490.304347826086, 0.9108695652173908, 15, 0.00231361, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:29:56.726788Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:56.726820Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m4.095e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m2549[0m [36mquery_id[0m=[35mfa86daec-890a-4086-8388-c1a4436ab312[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:29:56.726841Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m4.095e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35mfa86daec-890a-4086-8388-c1a4436ab312[0m
2025-12-02 17:29:56,726 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:29:56.736242Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m29cce25c-63e8-43a1-a9d5-2333ba6042e0[0m [36muser_id[0m=[35mcce6dbf8-57b6-4c38-aa0b-7d72ec824fa2[0m
[2m2025-12-02T16:29:56.736459Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:29cce25c-63e8-43a1-a9d5-2333ba6042e0[0m
2025-12-02 17:29:56,737 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:29:56,737 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:29:56,737 INFO sqlalchemy.engine.Engine [cached since 47.76s ago] ('29cce25c-63e8-43a1-a9d5-2333ba6042e0', 10)
[cached since 47.76s ago] ('29cce25c-63e8-43a1-a9d5-2333ba6042e0', 10)
[2m2025-12-02T16:29:56.737602Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m29cce25c-63e8-43a1-a9d5-2333ba6042e0[0m
[2m2025-12-02T16:29:56.737643Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m29cce25c-63e8-43a1-a9d5-2333ba6042e0[0m [36muser_id[0m=[35mcce6dbf8-57b6-4c38-aa0b-7d72ec824fa2[0m
[2m2025-12-02T16:29:56.737669Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35m¬øCu√°les son los mejores bares de tapas en Zaragoza?[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:29:59.582884Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m
[2m2025-12-02T16:29:59.582929Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mreasoning[0m=[35mEl usuario est√° pidiendo sugerencias sobre los mejores bares de tapas, lo que indica que busca recomendaciones en lugar de una b√∫squeda espec√≠fica de lugares.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:29:59.591660Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35m¬øCu√°les son los mejores bares de tapas en Zaragoza?[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:30:09.106665Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:30:09,106 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:30:09,107 INFO sqlalchemy.engine.Engine [cached since 52.9s ago] (UUID('9a221cc0-7a4b-44fa-920e-a9383ade38c8'), 'cce6dbf8-57b6-4c38-aa0b-7d72ec824fa2', '29cce25c-63e8-43a1-a9d5-2333ba6042e0', '¬øCu√°les son los mejores bares de tapas en Zaragoza?', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Parece que hubo un problema al intentar buscar los bares de tapas en Zaragoza. Sin embargo, puedo decirte que algunos de los bares de tapas m√°s conoc ... (365 characters truncated) ... Chema** - Famoso por su atenci√≥n al cliente y tapas innovadoras.\n\nSi necesitas m√°s informaci√≥n o quieres que busque algo espec√≠fico, h√°zmelo saber.', '[]', 12370, 4, 9, '{"query_id": "2ee12f6b-beff-4a5e-a509-954b476fff55", "reasoning": "El usuario est\\u00e1 pidiendo sugerencias sobre los mejores bares de tapas, lo que indica que busca recomendaciones en lugar de una b\\u00fasqueda espec\\u00edfica de lugares.", "cost_usd": 2.3594999999999997e-05}')
[cached since 52.9s ago] (UUID('9a221cc0-7a4b-44fa-920e-a9383ade38c8'), 'cce6dbf8-57b6-4c38-aa0b-7d72ec824fa2', '29cce25c-63e8-43a1-a9d5-2333ba6042e0', '¬øCu√°les son los mejores bares de tapas en Zaragoza?', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Parece que hubo un problema al intentar buscar los bares de tapas en Zaragoza. Sin embargo, puedo decirte que algunos de los bares de tapas m√°s conoc ... (365 characters truncated) ... Chema** - Famoso por su atenci√≥n al cliente y tapas innovadoras.\n\nSi necesitas m√°s informaci√≥n o quieres que busque algo espec√≠fico, h√°zmelo saber.', '[]', 12370, 4, 9, '{"query_id": "2ee12f6b-beff-4a5e-a509-954b476fff55", "reasoning": "El usuario est\\u00e1 pidiendo sugerencias sobre los mejores bares de tapas, lo que indica que busca recomendaciones en lugar de una b\\u00fasqueda espec\\u00edfica de lugares.", "cost_usd": 2.3594999999999997e-05}')
[2m2025-12-02T16:30:09.108085Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mturn_id[0m=[35m9a221cc0-7a4b-44fa-920e-a9383ade38c8[0m [36muser_id[0m=[35mcce6dbf8-57b6-4c38-aa0b-7d72ec824fa2[0m
[2m2025-12-02T16:30:09.108110Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m2ee12f6b-beff-4a5e-a509-954b476fff55[0m
2025-12-02 17:30:09,108 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:30:09,108 INFO sqlalchemy.engine.Engine [cached since 52.9s ago] (datetime.date(2025, 12, 2), 16)
[cached since 52.9s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:30:09,109 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:30:09,109 INFO sqlalchemy.engine.Engine [cached since 49.61s ago] (47, 5636.68085106383, 0.91063829787234, 16, 0.0023372049999999998, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 49.61s ago] (47, 5636.68085106383, 0.91063829787234, 16, 0.0023372049999999998, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:30:09.109426Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:30:09.109458Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m2.3594999999999997e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m12370[0m [36mquery_id[0m=[35m2ee12f6b-beff-4a5e-a509-954b476fff55[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:30:09.109477Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m2.3594999999999997e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m2ee12f6b-beff-4a5e-a509-954b476fff55[0m
2025-12-02 17:30:09,109 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:30:09.118975Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m7e2e56b9-d7a5-4f21-b155-0c78397e3d2b[0m [36muser_id[0m=[35m65e0aa3c-e0b5-45d4-9556-2b8646100bc6[0m
[2m2025-12-02T16:30:09.119250Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:7e2e56b9-d7a5-4f21-b155-0c78397e3d2b[0m
2025-12-02 17:30:09,119 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:30:09,119 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:30:09,119 INFO sqlalchemy.engine.Engine [cached since 60.14s ago] ('7e2e56b9-d7a5-4f21-b155-0c78397e3d2b', 10)
[cached since 60.14s ago] ('7e2e56b9-d7a5-4f21-b155-0c78397e3d2b', 10)
[2m2025-12-02T16:30:09.121019Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m7e2e56b9-d7a5-4f21-b155-0c78397e3d2b[0m
[2m2025-12-02T16:30:09.121048Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m7e2e56b9-d7a5-4f21-b155-0c78397e3d2b[0m [36muser_id[0m=[35m65e0aa3c-e0b5-45d4-9556-2b8646100bc6[0m
[2m2025-12-02T16:30:09.121065Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mCrea un plan para salir de bares por Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:30:11.591359Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mmedium[0m [36mconfidence[0m=[35m0.95[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mPLAN[0m
[2m2025-12-02T16:30:11.591424Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mmedium[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mPLAN[0m [36mreasoning[0m=[35mThe user explicitly asks for a plan to go bar hopping in Zaragoza, indicating a desire for a complete itinerary.[0m [36mselected[0m=[35mgpt-4-turbo[0m
[2m2025-12-02T16:30:11.599889Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4-turbo[0m [36mquery[0m=[35mCrea un plan para salir de bares por Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:30:15.864960Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:30:15,865 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:30:15,865 INFO sqlalchemy.engine.Engine [cached since 59.66s ago] (UUID('11b5d954-107f-4262-a5cf-06441b491158'), '65e0aa3c-e0b5-45d4-9556-2b8646100bc6', '7e2e56b9-d7a5-4f21-b155-0c78397e3d2b', 'Crea un plan para salir de bares por Zaragoza', 'es', 'PLAN', 0.95, 'medium', 'gpt-4-turbo', 'openai', 'Para ayudarte a crear el mejor plan de salida de bares en Zaragoza, necesito un poco m√°s de informaci√≥n:\n\n1. ¬øCu√°ntos bares te gustar√≠a visitar?\n2 ... (89 characters truncated) ... √≠fico de bar que prefieras (por ejemplo, bares de tapas, bares de copas, etc.)?\n\nCon estos detalles podr√© personalizar tu itinerario perfectamente.', '[]', 6746, 1, 3, '{"query_id": "0422ed21-a38f-4f0a-8962-2b1e2b5bc3ac", "reasoning": "The user explicitly asks for a plan to go bar hopping in Zaragoza, indicating a desire for a complete itinerary.", "cost_usd": 0.0009490000000000002}')
[cached since 59.66s ago] (UUID('11b5d954-107f-4262-a5cf-06441b491158'), '65e0aa3c-e0b5-45d4-9556-2b8646100bc6', '7e2e56b9-d7a5-4f21-b155-0c78397e3d2b', 'Crea un plan para salir de bares por Zaragoza', 'es', 'PLAN', 0.95, 'medium', 'gpt-4-turbo', 'openai', 'Para ayudarte a crear el mejor plan de salida de bares en Zaragoza, necesito un poco m√°s de informaci√≥n:\n\n1. ¬øCu√°ntos bares te gustar√≠a visitar?\n2 ... (89 characters truncated) ... √≠fico de bar que prefieras (por ejemplo, bares de tapas, bares de copas, etc.)?\n\nCon estos detalles podr√© personalizar tu itinerario perfectamente.', '[]', 6746, 1, 3, '{"query_id": "0422ed21-a38f-4f0a-8962-2b1e2b5bc3ac", "reasoning": "The user explicitly asks for a plan to go bar hopping in Zaragoza, indicating a desire for a complete itinerary.", "cost_usd": 0.0009490000000000002}')
[2m2025-12-02T16:30:15.865805Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mPLAN[0m [36mturn_id[0m=[35m11b5d954-107f-4262-a5cf-06441b491158[0m [36muser_id[0m=[35m65e0aa3c-e0b5-45d4-9556-2b8646100bc6[0m
[2m2025-12-02T16:30:15.865829Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m0422ed21-a38f-4f0a-8962-2b1e2b5bc3ac[0m
2025-12-02 17:30:15,865 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:30:15,866 INFO sqlalchemy.engine.Engine [cached since 59.66s ago] (datetime.date(2025, 12, 2), 16)
[cached since 59.66s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:30:15,866 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, plan_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, plan_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:30:15,866 INFO sqlalchemy.engine.Engine [generated in 0.00006s] (48, 5659.791666666667, 0.9114583333333329, 3, 0.003286205, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[generated in 0.00006s] (48, 5659.791666666667, 0.9114583333333329, 3, 0.003286205, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:30:15.866955Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mPLAN[0m [36mmodel[0m=[35mgpt-4-turbo[0m
[2m2025-12-02T16:30:15.866986Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m0.0009490000000000002[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mPLAN[0m [36mmodel[0m=[35mgpt-4-turbo[0m [36mprocessing_time_ms[0m=[35m6746[0m [36mquery_id[0m=[35m0422ed21-a38f-4f0a-8962-2b1e2b5bc3ac[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:30:15.867006Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m0.0009490000000000002[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m0422ed21-a38f-4f0a-8962-2b1e2b5bc3ac[0m
2025-12-02 17:30:15,867 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:30:15.876542Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m [36muser_id[0m=[35me7e026a9-0c3a-4397-9c8a-39427d7b0068[0m
[2m2025-12-02T16:30:15.876762Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m
2025-12-02 17:30:15,877 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:30:15,877 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:30:15,877 INFO sqlalchemy.engine.Engine [cached since 66.9s ago] ('00ffb6c1-4a27-4416-8aca-ff6eeeb6f137', 10)
[cached since 66.9s ago] ('00ffb6c1-4a27-4416-8aca-ff6eeeb6f137', 10)
[2m2025-12-02T16:30:15.878048Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m
[2m2025-12-02T16:30:15.878080Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m [36muser_id[0m=[35me7e026a9-0c3a-4397-9c8a-39427d7b0068[0m
[2m2025-12-02T16:30:15.878113Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mBusco restaurantes en Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:30:18.117517Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.95[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T16:30:18.117557Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user is explicitly looking for restaurants in Zaragoza, which qualifies as a search for specific places.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:30:18.126058Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mBusco restaurantes en Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:30:25.794016Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:30:25,794 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:30:25,794 INFO sqlalchemy.engine.Engine [cached since 69.59s ago] (UUID('a1e59635-b8b3-4993-84d8-e02e0a560353'), 'e7e026a9-0c3a-4397-9c8a-39427d7b0068', '00ffb6c1-4a27-4416-8aca-ff6eeeb6f137', 'Busco restaurantes en Zaragoza', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Parece que estoy teniendo problemas t√©cnicos para buscar restaurantes en Zaragoza en este momento. Sin embargo, puedo recomendarte que busques en √°re ... (56 characters truncated) ...  variedad de opciones. \n\nSi tienes un tipo espec√≠fico de comida en mente o un barrio en particular, h√°zmelo saber y te ayudar√© con m√°s informaci√≥n.', '[]', 9917, 4, 9, '{"query_id": "42ca926f-e88c-4ba3-9b3b-2a32d5f308d1", "reasoning": "The user is explicitly looking for restaurants in Zaragoza, which qualifies as a search for specific places.", "cost_usd": 1.17e-05}')
[cached since 69.59s ago] (UUID('a1e59635-b8b3-4993-84d8-e02e0a560353'), 'e7e026a9-0c3a-4397-9c8a-39427d7b0068', '00ffb6c1-4a27-4416-8aca-ff6eeeb6f137', 'Busco restaurantes en Zaragoza', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Parece que estoy teniendo problemas t√©cnicos para buscar restaurantes en Zaragoza en este momento. Sin embargo, puedo recomendarte que busques en √°re ... (56 characters truncated) ...  variedad de opciones. \n\nSi tienes un tipo espec√≠fico de comida en mente o un barrio en particular, h√°zmelo saber y te ayudar√© con m√°s informaci√≥n.', '[]', 9917, 4, 9, '{"query_id": "42ca926f-e88c-4ba3-9b3b-2a32d5f308d1", "reasoning": "The user is explicitly looking for restaurants in Zaragoza, which qualifies as a search for specific places.", "cost_usd": 1.17e-05}')
[2m2025-12-02T16:30:25.795097Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35ma1e59635-b8b3-4993-84d8-e02e0a560353[0m [36muser_id[0m=[35me7e026a9-0c3a-4397-9c8a-39427d7b0068[0m
[2m2025-12-02T16:30:25.795141Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m42ca926f-e88c-4ba3-9b3b-2a32d5f308d1[0m
2025-12-02 17:30:25,795 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:30:25,795 INFO sqlalchemy.engine.Engine [cached since 69.59s ago] (datetime.date(2025, 12, 2), 16)
[cached since 69.59s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:30:25,796 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:30:25,796 INFO sqlalchemy.engine.Engine [cached since 69.59s ago] (49, 5746.673469387755, 0.9122448979591833, 23, 0.003297905, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 69.59s ago] (49, 5746.673469387755, 0.9122448979591833, 23, 0.003297905, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:30:25.796564Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:30:25.796612Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m1.17e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m9917[0m [36mquery_id[0m=[35m42ca926f-e88c-4ba3-9b3b-2a32d5f308d1[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:30:25.796636Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m1.17e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m42ca926f-e88c-4ba3-9b3b-2a32d5f308d1[0m
2025-12-02 17:30:25,796 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T16:30:25.808444Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m [36muser_id[0m=[35me7e026a9-0c3a-4397-9c8a-39427d7b0068[0m
[2m2025-12-02T16:30:25.808759Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m
2025-12-02 17:30:25,809 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:30:25,809 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 17:30:25,809 INFO sqlalchemy.engine.Engine [cached since 76.83s ago] ('00ffb6c1-4a27-4416-8aca-ff6eeeb6f137', 10)
[cached since 76.83s ago] ('00ffb6c1-4a27-4416-8aca-ff6eeeb6f137', 10)
[2m2025-12-02T16:30:25.810193Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m1[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m
[2m2025-12-02T16:30:25.810491Z[0m [[32m[1mdebug    [0m] [1mcache_set                     [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m [36mttl[0m=[35m300[0m
[2m2025-12-02T16:30:25.810515Z[0m [[32m[1mdebug    [0m] [1msession_context_built         [0m [36mchars[0m=[35m474[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m [36mturns[0m=[35m1[0m
[2m2025-12-02T16:30:25.810536Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mTrue[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m00ffb6c1-4a27-4416-8aca-ff6eeeb6f137[0m [36muser_id[0m=[35me7e026a9-0c3a-4397-9c8a-39427d7b0068[0m
[2m2025-12-02T16:30:25.810552Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mAhora quiero museos[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:30:28.155447Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m
[2m2025-12-02T16:30:28.155519Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mreasoning[0m=[35mThe user is asking for suggestions about museums without specifying a location or particular type, which aligns with the intent to recommend.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:30:28.166643Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mAhora quiero museos[0m
[2m2025-12-02T16:30:28.166703Z[0m [[32m[1minfo     [0m] [1magent-using-history           [0m [36menvironment[0m=[35mdevelopment[0m [36mhistory_length[0m=[35m474[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T16:30:31.738196Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 17:30:31,738 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 17:30:31,738 INFO sqlalchemy.engine.Engine [cached since 75.53s ago] (UUID('22b19ee9-5c8d-436c-bce5-8c912ef9c80c'), 'e7e026a9-0c3a-4397-9c8a-39427d7b0068', '00ffb6c1-4a27-4416-8aca-ff6eeeb6f137', 'Ahora quiero museos', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Parece que ha habido un error al intentar buscar museos en Zaragoza. Sin embargo, puedo indicarte que algunos de los museos m√°s conocidos en Zaragoza son el Museo Pablo Gargallo, el Museo de Zaragoza y el CaixaForum. Si necesitas m√°s informaci√≥n sobre alguno de ellos, ¬°no dudes en preguntar!', '[]', 5929, 3, 7, '{"query_id": "607c0ead-cfbd-420e-912d-a09dd51b6154", "reasoning": "The user is asking for suggestions about museums without specifying a location or particular type, which aligns with the intent to recommend.", "cost_usd": 1.014e-05}')
[cached since 75.53s ago] (UUID('22b19ee9-5c8d-436c-bce5-8c912ef9c80c'), 'e7e026a9-0c3a-4397-9c8a-39427d7b0068', '00ffb6c1-4a27-4416-8aca-ff6eeeb6f137', 'Ahora quiero museos', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Parece que ha habido un error al intentar buscar museos en Zaragoza. Sin embargo, puedo indicarte que algunos de los museos m√°s conocidos en Zaragoza son el Museo Pablo Gargallo, el Museo de Zaragoza y el CaixaForum. Si necesitas m√°s informaci√≥n sobre alguno de ellos, ¬°no dudes en preguntar!', '[]', 5929, 3, 7, '{"query_id": "607c0ead-cfbd-420e-912d-a09dd51b6154", "reasoning": "The user is asking for suggestions about museums without specifying a location or particular type, which aligns with the intent to recommend.", "cost_usd": 1.014e-05}')
[2m2025-12-02T16:30:31.739873Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mturn_id[0m=[35m22b19ee9-5c8d-436c-bce5-8c912ef9c80c[0m [36muser_id[0m=[35me7e026a9-0c3a-4397-9c8a-39427d7b0068[0m
[2m2025-12-02T16:30:31.739926Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m607c0ead-cfbd-420e-912d-a09dd51b6154[0m
2025-12-02 17:30:31,740 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 17:30:31,740 INFO sqlalchemy.engine.Engine [cached since 75.53s ago] (datetime.date(2025, 12, 2), 16)
[cached since 75.53s ago] (datetime.date(2025, 12, 2), 16)
2025-12-02 17:30:31,740 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, recommend_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 17:30:31,741 INFO sqlalchemy.engine.Engine [cached since 72.24s ago] (50, 5750.32, 0.9119999999999996, 17, 0.003308045, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[cached since 72.24s ago] (50, 5750.32, 0.9119999999999996, 17, 0.003308045, UUID('561539a7-5ade-46fb-9e80-d86eb484f072'))
[2m2025-12-02T16:30:31.741579Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m16[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T16:30:31.741652Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m1.014e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m5929[0m [36mquery_id[0m=[35m607c0ead-cfbd-420e-912d-a09dd51b6154[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T16:30:31.741695Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m1.014e-05[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m607c0ead-cfbd-420e-912d-a09dd51b6154[0m
2025-12-02 17:30:31,741 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:51853 - "POST /agent/query HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'src/tools/place_tool.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
[2m2025-12-02T16:31:13.498265Z[0m [[32m[1minfo     [0m] [1müõë Shutting down Auphere Agent [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:13.503669Z[0m [[32m[1minfo     [0m] [1mdatabase_closed               [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:13.503715Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database connections closed [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:13.504052Z[0m [[32m[1minfo     [0m] [1mcache_disconnected            [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:13.504106Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache disconnected    [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:13.504136Z[0m [[32m[1minfo     [0m] [1müëã Auphere Agent stopped       [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application shutdown complete.
INFO:     Finished server process [16307]
INFO:     Started server process [16501]
INFO:     Waiting for application startup.
[2m2025-12-02T16:31:14.348664Z[0m [[32m[1minfo     [0m] [1müöÄ Starting Auphere Agent      [0m [36menvironment[0m=[35mdevelopment[0m [36mversion[0m=[35m0.1.0[0m
[2m2025-12-02T16:31:14.348714Z[0m [[32m[1minfo     [0m] [1mInitializing database...      [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:14.359853Z[0m [[32m[1minfo     [0m] [1mdatabase_engine_created       [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mlocalhost:5432/auphere-agent[0m
2025-12-02 17:31:14,368 INFO sqlalchemy.engine.Engine select pg_catalog.version()
select pg_catalog.version()
2025-12-02 17:31:14,368 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 17:31:14,369 INFO sqlalchemy.engine.Engine select current_schema()
select current_schema()
2025-12-02 17:31:14,369 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 17:31:14,369 INFO sqlalchemy.engine.Engine show standard_conforming_strings
show standard_conforming_strings
2025-12-02 17:31:14,369 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 17:31:14,370 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 17:31:14,371 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 17:31:14,371 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[generated in 0.00010s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 17:31:14,373 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 17:31:14,373 INFO sqlalchemy.engine.Engine [cached since 0.00234s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.00234s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 17:31:14,374 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 17:31:14,374 INFO sqlalchemy.engine.Engine [cached since 0.00269s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.00269s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 17:31:14,374 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
[2m2025-12-02T16:31:14.374625Z[0m [[32m[1minfo     [0m] [1mdatabase_initialized          [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:14.374656Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database initialized        [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:14.374671Z[0m [[32m[1minfo     [0m] [1mConnecting to Redis cache...  [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:14.375564Z[0m [[32m[1minfo     [0m] [1mcache_connected               [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mredis://localhost:6379/0[0m
[2m2025-12-02T16:31:14.375582Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache connected       [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T16:31:14.375594Z[0m [[32m[1minfo     [0m] [1m‚úÖ Auphere Agent ready!        [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application startup complete.
[2m2025-12-02T17:54:46.910770Z[0m [[32m[1minfo     [0m] [1msession_factory_created       [0m [36menvironment[0m=[35mdevelopment[0m
2025-12-02 18:54:46,927 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 18:54:46,927 INFO sqlalchemy.engine.Engine SELECT 1
SELECT 1
2025-12-02 18:54:46,927 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ()
[generated in 0.00015s] ()
2025-12-02 18:54:46,929 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:52842 - "GET /agent/health HTTP/1.1" 200 OK
[2m2025-12-02T17:55:14.553340Z[0m [[32m[1minfo     [0m] [1mlocale_loaded                 [0m [36menvironment[0m=[35mdevelopment[0m [36mkeys[0m=[35m6[0m [36mlanguage[0m=[35mes[0m
[2m2025-12-02T17:55:14.553643Z[0m [[32m[1minfo     [0m] [1mlocale_loaded                 [0m [36menvironment[0m=[35mdevelopment[0m [36mkeys[0m=[35m6[0m [36mlanguage[0m=[35men[0m
[2m2025-12-02T17:55:14.554643Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440000[0m
[2m2025-12-02T17:55:14.555211Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:550e8400-e29b-41d4-a716-446655440001[0m
2025-12-02 18:55:14,556 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 18:55:14,558 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 18:55:14,558 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ('550e8400-e29b-41d4-a716-446655440001', 10)
[generated in 0.00009s] ('550e8400-e29b-41d4-a716-446655440001', 10)
[2m2025-12-02T17:55:14.561910Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m
[2m2025-12-02T17:55:14.561940Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440000[0m
[2m2025-12-02T17:55:14.561961Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mBusco un bar[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T17:55:18.419112Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T17:55:18.419217Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user is explicitly looking for a bar, which indicates a specific search for a location.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T17:55:18.428893Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mBusco un bar[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T17:55:19.840727Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 18:55:19,843 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 18:55:19,843 INFO sqlalchemy.engine.Engine [generated in 0.00031s] (UUID('6abc979a-415f-4577-8343-483f1f77bb1a'), '550e8400-e29b-41d4-a716-446655440000', '550e8400-e29b-41d4-a716-446655440001', 'Busco un bar', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', '¬øEn qu√© ciudad buscas el bar?', '[]', 5286, 1, 3, '{"query_id": "9365f198-8c36-4016-88dc-f9cbb15f76e4", "reasoning": "The user is explicitly looking for a bar, which indicates a specific search for a location.", "cost_usd": 1.755e-06}')
[generated in 0.00031s] (UUID('6abc979a-415f-4577-8343-483f1f77bb1a'), '550e8400-e29b-41d4-a716-446655440000', '550e8400-e29b-41d4-a716-446655440001', 'Busco un bar', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', '¬øEn qu√© ciudad buscas el bar?', '[]', 5286, 1, 3, '{"query_id": "9365f198-8c36-4016-88dc-f9cbb15f76e4", "reasoning": "The user is explicitly looking for a bar, which indicates a specific search for a location.", "cost_usd": 1.755e-06}')
[2m2025-12-02T17:55:19.847281Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35m6abc979a-415f-4577-8343-483f1f77bb1a[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440000[0m
[2m2025-12-02T17:55:19.847349Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m9365f198-8c36-4016-88dc-f9cbb15f76e4[0m
2025-12-02 18:55:19,848 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 18:55:19,848 INFO sqlalchemy.engine.Engine [generated in 0.00009s] (datetime.date(2025, 12, 2), 17)
[generated in 0.00009s] (datetime.date(2025, 12, 2), 17)
[2m2025-12-02T17:55:19.850663Z[0m [[31m[1merror    [0m] [1mfailed_to_record_metrics      [0m [36menvironment[0m=[35mdevelopment[0m [36merror[0m=[35munsupported operand type(s) for +=: 'NoneType' and 'int'[0m [36mquery_id[0m=[35m9365f198-8c36-4016-88dc-f9cbb15f76e4[0m
2025-12-02 18:55:19,851 INFO sqlalchemy.engine.Engine INSERT INTO agent_metrics (id, date, hour, total_queries, avg_processing_time_ms, avg_confidence, search_count, recommend_count, plan_count, chitchat_count, model_usage, estimated_cost_usd, created_at) VALUES ($1::UUID, $2::TIMESTAMP WITHOUT TIME ZONE, $3::BIGINT, $4::BIGINT, $5::FLOAT, $6::FLOAT, $7::BIGINT, $8::BIGINT, $9::BIGINT, $10::BIGINT, $11::JSON, $12::FLOAT, now()) RETURNING agent_metrics.created_at
INSERT INTO agent_metrics (id, date, hour, total_queries, avg_processing_time_ms, avg_confidence, search_count, recommend_count, plan_count, chitchat_count, model_usage, estimated_cost_usd, created_at) VALUES ($1::UUID, $2::TIMESTAMP WITHOUT TIME ZONE, $3::BIGINT, $4::BIGINT, $5::FLOAT, $6::FLOAT, $7::BIGINT, $8::BIGINT, $9::BIGINT, $10::BIGINT, $11::JSON, $12::FLOAT, now()) RETURNING agent_metrics.created_at
2025-12-02 18:55:19,851 INFO sqlalchemy.engine.Engine [generated in 0.00017s] (UUID('ccda268e-69bc-462a-a928-632ef2af9e1b'), datetime.date(2025, 12, 2), 17, 1, 5286.0, 0.9, 0, 0, 0, 0, '{}', 0.0)
[generated in 0.00017s] (UUID('ccda268e-69bc-462a-a928-632ef2af9e1b'), datetime.date(2025, 12, 2), 17, 1, 5286.0, 0.9, 0, 0, 0, 0, '{}', 0.0)
2025-12-02 18:55:19,852 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:53018 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T17:55:29.338493Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440000[0m
[2m2025-12-02T17:55:29.338898Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:550e8400-e29b-41d4-a716-446655440001[0m
2025-12-02 18:55:29,339 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 18:55:29,339 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 18:55:29,339 INFO sqlalchemy.engine.Engine [cached since 14.78s ago] ('550e8400-e29b-41d4-a716-446655440001', 10)
[cached since 14.78s ago] ('550e8400-e29b-41d4-a716-446655440001', 10)
[2m2025-12-02T17:55:29.340491Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m1[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m
[2m2025-12-02T17:55:29.340782Z[0m [[32m[1mdebug    [0m] [1mcache_set                     [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:550e8400-e29b-41d4-a716-446655440001[0m [36mttl[0m=[35m300[0m
[2m2025-12-02T17:55:29.340800Z[0m [[32m[1mdebug    [0m] [1msession_context_built         [0m [36mchars[0m=[35m133[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m [36mturns[0m=[35m1[0m
[2m2025-12-02T17:55:29.340818Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mTrue[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440000[0m
[2m2025-12-02T17:55:29.340833Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mEn Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T17:55:31.444277Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T17:55:31.444340Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user provided a specific location (Zaragoza), which indicates they are looking for information related to that place.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T17:55:31.453165Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mEn Zaragoza[0m
[2m2025-12-02T17:55:31.453210Z[0m [[32m[1minfo     [0m] [1magent-using-history           [0m [36menvironment[0m=[35mdevelopment[0m [36mhistory_length[0m=[35m133[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T17:55:33.253330Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 18:55:33,253 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 18:55:33,253 INFO sqlalchemy.engine.Engine [cached since 13.41s ago] (UUID('0c079c3b-a9e1-48ff-a360-fa2589c8f6f5'), '550e8400-e29b-41d4-a716-446655440000', '550e8400-e29b-41d4-a716-446655440001', 'En Zaragoza', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Perfecto. ¬øQu√© tipo de bar prefieres? ¬øDe tapas, de copas, tranquilo, o algo espec√≠fico?', '[]', 3914, 2, 5, '{"query_id": "729568b0-b736-45a7-b4a4-edcfae9a269b", "reasoning": "The user provided a specific location (Zaragoza), which indicates they are looking for information related to that place.", "cost_usd": 3.1199999999999998e-06}')
[cached since 13.41s ago] (UUID('0c079c3b-a9e1-48ff-a360-fa2589c8f6f5'), '550e8400-e29b-41d4-a716-446655440000', '550e8400-e29b-41d4-a716-446655440001', 'En Zaragoza', 'es', 'SEARCH', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Perfecto. ¬øQu√© tipo de bar prefieres? ¬øDe tapas, de copas, tranquilo, o algo espec√≠fico?', '[]', 3914, 2, 5, '{"query_id": "729568b0-b736-45a7-b4a4-edcfae9a269b", "reasoning": "The user provided a specific location (Zaragoza), which indicates they are looking for information related to that place.", "cost_usd": 3.1199999999999998e-06}')
[2m2025-12-02T17:55:33.255263Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35m0c079c3b-a9e1-48ff-a360-fa2589c8f6f5[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440000[0m
[2m2025-12-02T17:55:33.255290Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m729568b0-b736-45a7-b4a4-edcfae9a269b[0m
2025-12-02 18:55:33,255 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 18:55:33,255 INFO sqlalchemy.engine.Engine [cached since 13.41s ago] (datetime.date(2025, 12, 2), 17)
[cached since 13.41s ago] (datetime.date(2025, 12, 2), 17)
2025-12-02 18:55:33,256 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, search_count=$3::BIGINT, estimated_cost_usd=$4::FLOAT WHERE agent_metrics.id = $5::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, search_count=$3::BIGINT, estimated_cost_usd=$4::FLOAT WHERE agent_metrics.id = $5::UUID
2025-12-02 18:55:33,256 INFO sqlalchemy.engine.Engine [generated in 0.00005s] (2, 4600.0, 1, 3.1199999999999998e-06, UUID('ccda268e-69bc-462a-a928-632ef2af9e1b'))
[generated in 0.00005s] (2, 4600.0, 1, 3.1199999999999998e-06, UUID('ccda268e-69bc-462a-a928-632ef2af9e1b'))
[2m2025-12-02T17:55:33.257240Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m17[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T17:55:33.257278Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m3.1199999999999998e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m3914[0m [36mquery_id[0m=[35m729568b0-b736-45a7-b4a4-edcfae9a269b[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T17:55:33.257299Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m3.1199999999999998e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m729568b0-b736-45a7-b4a4-edcfae9a269b[0m
2025-12-02 18:55:33,257 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:53114 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T17:55:41.786186Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440000[0m
[2m2025-12-02T17:55:41.786484Z[0m [[32m[1mdebug    [0m] [1mcache_hit                     [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:550e8400-e29b-41d4-a716-446655440001[0m
[2m2025-12-02T17:55:41.786528Z[0m [[32m[1mdebug    [0m] [1msession_context_cache_hit     [0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m
[2m2025-12-02T17:55:41.786563Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mTrue[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440001[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440000[0m
[2m2025-12-02T17:55:41.786593Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mDe tapas, dame opciones[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T17:55:42.981883Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.9[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m
[2m2025-12-02T17:55:42.981930Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mreasoning[0m=[35mThe user is asking for options regarding tapas, which suggests they are looking for suggestions rather than specific locations or a detailed plan.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T17:55:42.990384Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mDe tapas, dame opciones[0m
[2m2025-12-02T17:55:42.990423Z[0m [[32m[1minfo     [0m] [1magent-using-history           [0m [36menvironment[0m=[35mdevelopment[0m [36mhistory_length[0m=[35m133[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T17:55:44.210468Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 18:55:44,211 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 18:55:44,211 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 18:55:44,211 INFO sqlalchemy.engine.Engine [cached since 24.37s ago] (UUID('0835af21-a84d-4102-a92e-9114360847de'), '550e8400-e29b-41d4-a716-446655440000', '550e8400-e29b-41d4-a716-446655440001', 'De tapas, dame opciones', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Lo siento, actualmente solo tengo informaci√≥n de lugares en Zaragoza. ¬øTe gustar√≠a buscar algo all√≠?', '[]', 2424, 2, 5, '{"query_id": "e71a0a81-0fa0-49e5-89ee-fccc08b6713b", "reasoning": "The user is asking for options regarding tapas, which suggests they are looking for suggestions rather than specific locations or a detailed plan.", "cost_usd": 3.7049999999999997e-06}')
[cached since 24.37s ago] (UUID('0835af21-a84d-4102-a92e-9114360847de'), '550e8400-e29b-41d4-a716-446655440000', '550e8400-e29b-41d4-a716-446655440001', 'De tapas, dame opciones', 'es', 'RECOMMEND', 0.9, 'low', 'gpt-4o-mini', 'openai', 'Lo siento, actualmente solo tengo informaci√≥n de lugares en Zaragoza. ¬øTe gustar√≠a buscar algo all√≠?', '[]', 2424, 2, 5, '{"query_id": "e71a0a81-0fa0-49e5-89ee-fccc08b6713b", "reasoning": "The user is asking for options regarding tapas, which suggests they are looking for suggestions rather than specific locations or a detailed plan.", "cost_usd": 3.7049999999999997e-06}')
[2m2025-12-02T17:55:44.211829Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mturn_id[0m=[35m0835af21-a84d-4102-a92e-9114360847de[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440000[0m
[2m2025-12-02T17:55:44.211859Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35me71a0a81-0fa0-49e5-89ee-fccc08b6713b[0m
2025-12-02 18:55:44,212 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 18:55:44,212 INFO sqlalchemy.engine.Engine [cached since 24.36s ago] (datetime.date(2025, 12, 2), 17)
[cached since 24.36s ago] (datetime.date(2025, 12, 2), 17)
2025-12-02 18:55:44,212 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, recommend_count=$3::BIGINT, estimated_cost_usd=$4::FLOAT WHERE agent_metrics.id = $5::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, recommend_count=$3::BIGINT, estimated_cost_usd=$4::FLOAT WHERE agent_metrics.id = $5::UUID
2025-12-02 18:55:44,212 INFO sqlalchemy.engine.Engine [generated in 0.00005s] (3, 3874.6666666666665, 1, 6.825e-06, UUID('ccda268e-69bc-462a-a928-632ef2af9e1b'))
[generated in 0.00005s] (3, 3874.6666666666665, 1, 6.825e-06, UUID('ccda268e-69bc-462a-a928-632ef2af9e1b'))
[2m2025-12-02T17:55:44.213185Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m17[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T17:55:44.213217Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m3.7049999999999997e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mRECOMMEND[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m2424[0m [36mquery_id[0m=[35me71a0a81-0fa0-49e5-89ee-fccc08b6713b[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T17:55:44.213236Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m3.7049999999999997e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35me71a0a81-0fa0-49e5-89ee-fccc08b6713b[0m
2025-12-02 18:55:44,213 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:53206 - "POST /agent/query HTTP/1.1" 200 OK
[2m2025-12-02T17:56:12.797635Z[0m [[32m[1minfo     [0m] [1mcontext-validated             [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_location[0m=[35mFalse[0m [36mlanguage[0m=[35mes[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440003[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440002[0m
[2m2025-12-02T17:56:12.797918Z[0m [[32m[1mdebug    [0m] [1mcache_miss                    [0m [36menvironment[0m=[35mdevelopment[0m [36mkey[0m=[35msession_context:550e8400-e29b-41d4-a716-446655440003[0m
2025-12-02 18:56:12,798 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 18:56:12,798 INFO sqlalchemy.engine.Engine SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
SELECT conversation_turns.id, conversation_turns.user_id, conversation_turns.session_id, conversation_turns.user_query, conversation_turns.query_language, conversation_turns.intention, conversation_turns.confidence, conversation_turns.complexity, conversation_turns.model_used, conversation_turns.model_provider, conversation_turns.agent_response, conversation_turns.places_found, conversation_turns.processing_time_ms, conversation_turns.tool_calls, conversation_turns.reasoning_steps, conversation_turns.extra_metadata, conversation_turns.created_at, conversation_turns.updated_at 
FROM conversation_turns 
WHERE conversation_turns.session_id = $1::UUID ORDER BY conversation_turns.created_at DESC 
 LIMIT $2::INTEGER
2025-12-02 18:56:12,798 INFO sqlalchemy.engine.Engine [cached since 58.24s ago] ('550e8400-e29b-41d4-a716-446655440003', 10)
[cached since 58.24s ago] ('550e8400-e29b-41d4-a716-446655440003', 10)
[2m2025-12-02T17:56:12.799300Z[0m [[32m[1mdebug    [0m] [1msession_history_retrieved     [0m [36mcount[0m=[35m0[0m [36menvironment[0m=[35mdevelopment[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440003[0m
[2m2025-12-02T17:56:12.799329Z[0m [[32m[1mdebug    [0m] [1magent_context_built           [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_history[0m=[35mFalse[0m [36mhas_patterns[0m=[35mFalse[0m [36msession_id[0m=[35m550e8400-e29b-41d4-a716-446655440003[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440002[0m
[2m2025-12-02T17:56:12.799347Z[0m [[32m[1mdebug    [0m] [1mclassifying-intent            [0m [36menvironment[0m=[35mdevelopment[0m [36mlanguage[0m=[35mes[0m [36mquery[0m=[35mBusco bares en Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T17:56:14.962054Z[0m [[32m[1minfo     [0m] [1mintent-classified             [0m [36mcomplexity[0m=[35mlow[0m [36mconfidence[0m=[35m0.95[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m
[2m2025-12-02T17:56:14.962114Z[0m [[32m[1minfo     [0m] [1mmodel-routed                  [0m [36mcomplexity[0m=[35mlow[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mreasoning[0m=[35mThe user is explicitly looking for bars in Zaragoza, which indicates a specific search for places.[0m [36mselected[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T17:56:14.970131Z[0m [[32m[1minfo     [0m] [1magent-starting                [0m [36menvironment[0m=[35mdevelopment[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mquery[0m=[35mBusco bares en Zaragoza[0m
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2m2025-12-02T17:56:23.823697Z[0m [[32m[1minfo     [0m] [1magent-completed               [0m [36menvironment[0m=[35mdevelopment[0m [36mhas_response[0m=[35mTrue[0m
2025-12-02 18:56:23,824 INFO sqlalchemy.engine.Engine INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
INSERT INTO conversation_turns (id, user_id, session_id, user_query, query_language, intention, confidence, complexity, model_used, model_provider, agent_response, places_found, processing_time_ms, tool_calls, reasoning_steps, extra_metadata, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::FLOAT, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::BIGINT, $14::BIGINT, $15::BIGINT, $16::JSON, now(), now()) RETURNING conversation_turns.created_at, conversation_turns.updated_at
2025-12-02 18:56:23,824 INFO sqlalchemy.engine.Engine [cached since 63.98s ago] (UUID('6c9028cd-35f7-4918-9d8d-3ee632950c0d'), '550e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440003', 'Busco bares en Zaragoza', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Parece que ha habido un problema al intentar buscar bares en Zaragoza. Sin embargo, puedo ayudarte con recomendaciones. \n\n¬øTienes alg√∫n tipo de bar espec√≠fico en mente, como de tapas, de copas, o uno m√°s tranquilo?', '[]', 11026, 6, 13, '{"query_id": "7e0c3adf-6751-417a-a2e5-ccba8cc6a254", "reasoning": "The user is explicitly looking for bars in Zaragoza, which indicates a specific search for places.", "cost_usd": 7.605e-06}')
[cached since 63.98s ago] (UUID('6c9028cd-35f7-4918-9d8d-3ee632950c0d'), '550e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440003', 'Busco bares en Zaragoza', 'es', 'SEARCH', 0.95, 'low', 'gpt-4o-mini', 'openai', 'Parece que ha habido un problema al intentar buscar bares en Zaragoza. Sin embargo, puedo ayudarte con recomendaciones. \n\n¬øTienes alg√∫n tipo de bar espec√≠fico en mente, como de tapas, de copas, o uno m√°s tranquilo?', '[]', 11026, 6, 13, '{"query_id": "7e0c3adf-6751-417a-a2e5-ccba8cc6a254", "reasoning": "The user is explicitly looking for bars in Zaragoza, which indicates a specific search for places.", "cost_usd": 7.605e-06}')
[2m2025-12-02T17:56:23.824632Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mturn_id[0m=[35m6c9028cd-35f7-4918-9d8d-3ee632950c0d[0m [36muser_id[0m=[35m550e8400-e29b-41d4-a716-446655440002[0m
[2m2025-12-02T17:56:23.824664Z[0m [[32m[1minfo     [0m] [1mconversation_turn_saved       [0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m7e0c3adf-6751-417a-a2e5-ccba8cc6a254[0m
2025-12-02 18:56:23,824 INFO sqlalchemy.engine.Engine SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
SELECT agent_metrics.id, agent_metrics.date, agent_metrics.hour, agent_metrics.total_queries, agent_metrics.avg_processing_time_ms, agent_metrics.avg_confidence, agent_metrics.search_count, agent_metrics.recommend_count, agent_metrics.plan_count, agent_metrics.chitchat_count, agent_metrics.model_usage, agent_metrics.estimated_cost_usd, agent_metrics.created_at 
FROM agent_metrics 
WHERE agent_metrics.date = $1::DATE AND agent_metrics.hour = $2::BIGINT
2025-12-02 18:56:23,824 INFO sqlalchemy.engine.Engine [cached since 63.98s ago] (datetime.date(2025, 12, 2), 17)
[cached since 63.98s ago] (datetime.date(2025, 12, 2), 17)
2025-12-02 18:56:23,825 INFO sqlalchemy.engine.Engine UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
UPDATE agent_metrics SET total_queries=$1::BIGINT, avg_processing_time_ms=$2::FLOAT, avg_confidence=$3::FLOAT, search_count=$4::BIGINT, estimated_cost_usd=$5::FLOAT WHERE agent_metrics.id = $6::UUID
2025-12-02 18:56:23,825 INFO sqlalchemy.engine.Engine [generated in 0.00008s] (4, 5662.5, 0.9125000000000001, 2, 1.4429999999999999e-05, UUID('ccda268e-69bc-462a-a928-632ef2af9e1b'))
[generated in 0.00008s] (4, 5662.5, 0.9125000000000001, 2, 1.4429999999999999e-05, UUID('ccda268e-69bc-462a-a928-632ef2af9e1b'))
[2m2025-12-02T17:56:23.825988Z[0m [[32m[1mdebug    [0m] [1mmetrics_recorded              [0m [36mdate[0m=[35m2025-12-02[0m [36menvironment[0m=[35mdevelopment[0m [36mhour[0m=[35m17[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m
[2m2025-12-02T17:56:23.826024Z[0m [[32m[1minfo     [0m] [1mquery_metrics_recorded        [0m [36mcost[0m=[35m7.605e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mintention[0m=[35mSEARCH[0m [36mmodel[0m=[35mgpt-4o-mini[0m [36mprocessing_time_ms[0m=[35m11026[0m [36mquery_id[0m=[35m7e0c3adf-6751-417a-a2e5-ccba8cc6a254[0m [36msuccess[0m=[35mTrue[0m
[2m2025-12-02T17:56:23.826048Z[0m [[32m[1minfo     [0m] [1mmetrics_recorded              [0m [36mcost[0m=[35m7.605e-06[0m [36menvironment[0m=[35mdevelopment[0m [36mquery_id[0m=[35m7e0c3adf-6751-417a-a2e5-ccba8cc6a254[0m
2025-12-02 18:56:23,826 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
INFO:     127.0.0.1:53399 - "POST /agent/query HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'src/tools/place_tool.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
[2m2025-12-02T18:00:04.267429Z[0m [[32m[1minfo     [0m] [1müõë Shutting down Auphere Agent [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:04.272027Z[0m [[32m[1minfo     [0m] [1mdatabase_closed               [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:04.272068Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database connections closed [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:04.272285Z[0m [[32m[1minfo     [0m] [1mcache_disconnected            [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:04.272303Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache disconnected    [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:04.272320Z[0m [[32m[1minfo     [0m] [1müëã Auphere Agent stopped       [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application shutdown complete.
INFO:     Finished server process [16501]
INFO:     Started server process [20434]
INFO:     Waiting for application startup.
[2m2025-12-02T18:00:05.060318Z[0m [[32m[1minfo     [0m] [1müöÄ Starting Auphere Agent      [0m [36menvironment[0m=[35mdevelopment[0m [36mversion[0m=[35m0.1.0[0m
[2m2025-12-02T18:00:05.060362Z[0m [[32m[1minfo     [0m] [1mInitializing database...      [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:05.072799Z[0m [[32m[1minfo     [0m] [1mdatabase_engine_created       [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mlocalhost:5432/auphere-agent[0m
2025-12-02 19:00:05,079 INFO sqlalchemy.engine.Engine select pg_catalog.version()
select pg_catalog.version()
2025-12-02 19:00:05,079 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 19:00:05,080 INFO sqlalchemy.engine.Engine select current_schema()
select current_schema()
2025-12-02 19:00:05,080 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 19:00:05,081 INFO sqlalchemy.engine.Engine show standard_conforming_strings
show standard_conforming_strings
2025-12-02 19:00:05,081 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 19:00:05,081 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 19:00:05,082 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 19:00:05,082 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[generated in 0.00007s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 19:00:05,085 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 19:00:05,085 INFO sqlalchemy.engine.Engine [cached since 0.003272s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.003272s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 19:00:05,086 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 19:00:05,086 INFO sqlalchemy.engine.Engine [cached since 0.003699s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.003699s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 19:00:05,086 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
[2m2025-12-02T18:00:05.087015Z[0m [[32m[1minfo     [0m] [1mdatabase_initialized          [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:05.087057Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database initialized        [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:05.087217Z[0m [[32m[1minfo     [0m] [1mConnecting to Redis cache...  [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:05.088218Z[0m [[32m[1minfo     [0m] [1mcache_connected               [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mredis://localhost:6379/0[0m
[2m2025-12-02T18:00:05.088243Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache connected       [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:05.088258Z[0m [[32m[1minfo     [0m] [1m‚úÖ Auphere Agent ready!        [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'src/tools/place_tool.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
[2m2025-12-02T18:00:21.654605Z[0m [[32m[1minfo     [0m] [1müõë Shutting down Auphere Agent [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:21.658579Z[0m [[32m[1minfo     [0m] [1mdatabase_closed               [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:21.658600Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database connections closed [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:21.658743Z[0m [[32m[1minfo     [0m] [1mcache_disconnected            [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:21.658757Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache disconnected    [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:21.658767Z[0m [[32m[1minfo     [0m] [1müëã Auphere Agent stopped       [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application shutdown complete.
INFO:     Finished server process [20434]
INFO:     Started server process [20456]
INFO:     Waiting for application startup.
[2m2025-12-02T18:00:22.368041Z[0m [[32m[1minfo     [0m] [1müöÄ Starting Auphere Agent      [0m [36menvironment[0m=[35mdevelopment[0m [36mversion[0m=[35m0.1.0[0m
[2m2025-12-02T18:00:22.368086Z[0m [[32m[1minfo     [0m] [1mInitializing database...      [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:22.376771Z[0m [[32m[1minfo     [0m] [1mdatabase_engine_created       [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mlocalhost:5432/auphere-agent[0m
2025-12-02 19:00:22,384 INFO sqlalchemy.engine.Engine select pg_catalog.version()
select pg_catalog.version()
2025-12-02 19:00:22,384 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 19:00:22,385 INFO sqlalchemy.engine.Engine select current_schema()
select current_schema()
2025-12-02 19:00:22,385 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 19:00:22,386 INFO sqlalchemy.engine.Engine show standard_conforming_strings
show standard_conforming_strings
2025-12-02 19:00:22,386 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 19:00:22,386 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 19:00:22,388 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 19:00:22,388 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[generated in 0.00009s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 19:00:22,390 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 19:00:22,391 INFO sqlalchemy.engine.Engine [cached since 0.002901s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.002901s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 19:00:22,391 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 19:00:22,391 INFO sqlalchemy.engine.Engine [cached since 0.003255s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.003255s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 19:00:22,391 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
[2m2025-12-02T18:00:22.391877Z[0m [[32m[1minfo     [0m] [1mdatabase_initialized          [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:22.391907Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database initialized        [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:22.391921Z[0m [[32m[1minfo     [0m] [1mConnecting to Redis cache...  [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:22.392932Z[0m [[32m[1minfo     [0m] [1mcache_connected               [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mredis://localhost:6379/0[0m
[2m2025-12-02T18:00:22.392959Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache connected       [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:22.392973Z[0m [[32m[1minfo     [0m] [1m‚úÖ Auphere Agent ready!        [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'src/tools/place_tool.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
[2m2025-12-02T18:00:40.069217Z[0m [[32m[1minfo     [0m] [1müõë Shutting down Auphere Agent [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.072420Z[0m [[32m[1minfo     [0m] [1mdatabase_closed               [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.072444Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database connections closed [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.072633Z[0m [[32m[1minfo     [0m] [1mcache_disconnected            [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.072650Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache disconnected    [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.072662Z[0m [[32m[1minfo     [0m] [1müëã Auphere Agent stopped       [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application shutdown complete.
INFO:     Finished server process [20456]
INFO:     Started server process [20478]
INFO:     Waiting for application startup.
[2m2025-12-02T18:00:40.787148Z[0m [[32m[1minfo     [0m] [1müöÄ Starting Auphere Agent      [0m [36menvironment[0m=[35mdevelopment[0m [36mversion[0m=[35m0.1.0[0m
[2m2025-12-02T18:00:40.787191Z[0m [[32m[1minfo     [0m] [1mInitializing database...      [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.795702Z[0m [[32m[1minfo     [0m] [1mdatabase_engine_created       [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mlocalhost:5432/auphere-agent[0m
2025-12-02 19:00:40,803 INFO sqlalchemy.engine.Engine select pg_catalog.version()
select pg_catalog.version()
2025-12-02 19:00:40,803 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 19:00:40,804 INFO sqlalchemy.engine.Engine select current_schema()
select current_schema()
2025-12-02 19:00:40,804 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 19:00:40,804 INFO sqlalchemy.engine.Engine show standard_conforming_strings
show standard_conforming_strings
2025-12-02 19:00:40,804 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2025-12-02 19:00:40,805 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2025-12-02 19:00:40,806 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 19:00:40,806 INFO sqlalchemy.engine.Engine [generated in 0.00013s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[generated in 0.00013s] ('conversation_turns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 19:00:40,808 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 19:00:40,808 INFO sqlalchemy.engine.Engine [cached since 0.002304s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.002304s ago] ('user_preferences', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 19:00:40,809 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 19:00:40,809 INFO sqlalchemy.engine.Engine [cached since 0.002741s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.002741s ago] ('agent_metrics', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 19:00:40,809 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
[2m2025-12-02T18:00:40.809851Z[0m [[32m[1minfo     [0m] [1mdatabase_initialized          [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.809881Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database initialized        [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.809896Z[0m [[32m[1minfo     [0m] [1mConnecting to Redis cache...  [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.810942Z[0m [[32m[1minfo     [0m] [1mcache_connected               [0m [36menvironment[0m=[35mdevelopment[0m [36murl[0m=[35mredis://localhost:6379/0[0m
[2m2025-12-02T18:00:40.810969Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache connected       [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:00:40.810984Z[0m [[32m[1minfo     [0m] [1m‚úÖ Auphere Agent ready!        [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application startup complete.
INFO:     Shutting down
INFO:     Waiting for application shutdown.
[2m2025-12-02T18:01:07.983791Z[0m [[32m[1minfo     [0m] [1müõë Shutting down Auphere Agent [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:01:07.988180Z[0m [[32m[1minfo     [0m] [1mdatabase_closed               [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:01:07.988223Z[0m [[32m[1minfo     [0m] [1m‚úÖ Database connections closed [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:01:07.988503Z[0m [[32m[1minfo     [0m] [1mcache_disconnected            [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:01:07.988528Z[0m [[32m[1minfo     [0m] [1m‚úÖ Redis cache disconnected    [0m [36menvironment[0m=[35mdevelopment[0m
[2m2025-12-02T18:01:07.988549Z[0m [[32m[1minfo     [0m] [1müëã Auphere Agent stopped       [0m [36menvironment[0m=[35mdevelopment[0m
INFO:     Application shutdown complete.
INFO:     Finished server process [20478]
INFO:     Stopping reloader process [16303]
